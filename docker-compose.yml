services:
    mongo:
        image: mongo
        restart: always
        environment:
            MONGO_INITDB_ROOT_USERNAME: ${MONGODB_USER}
            MONGO_INITDB_ROOT_PASSWORD: ${MONGODB_PASSWORD}
        ports:
        - 27017:27017
    mongo-express:
        image: mongo-express
        restart: always
        environment:
            ME_CONFIG_MONGODB_ADMINUSERNAME: ${MONGODB_USER}
            ME_CONFIG_MONGODB_ADMINPASSWORD: ${MONGODB_PASSWORD}
        ports:
        - 8081:8081
    postgres:
        container_name: postgres
        build:
            dockerfile: Dockerfile
            context: ./postgres
        ports:
          - "${POSTGRES_PORT}:5432"
        environment:
            POSTGRES_DB: ${POSTGRES_DB}
            POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
            PGDATA: /var/lib/postgresql/data/pgdata
        volumes:
          - ./postgres/conf/postgresql.conf:/tmp/postgresql.conf
          - ./postgres/${POSTGRES_VOLUME}:/var/lib/postgresql/data/pgdata
    pgadmin:
        image: dpage/pgadmin4
        container_name: pgadmin
        depends_on:
          - postgres
        ports:
          - "${PGADMIN_PORT}:80"
        environment:
          PGADMIN_DEFAULT_EMAIL: ${PGADMIN_DEFAULT_EMAIL}
          PGADMIN_DEFAULT_PASSWORD: ${PGADMIN_DEFAULT_PASSWORD}
    nest:
        container_name: nest
        depends_on:
            - mongo
            - postgres
        build:
            dockerfile: Dockerfile
            context: ./
        ports:
            - ${PORT}:${PORT}